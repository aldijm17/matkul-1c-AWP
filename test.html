<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScheduleOS - Prototype Notifikasi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --border-default: #30363d;
            --accent-primary: #58a6ff;
            --accent-success: #3fb950;
            --accent-warning: #d29922;
            --accent-secondary: #f85149;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: var(--accent-primary);
            margin-bottom: 10px;
        }
        
        .description {
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
        }
        
        .panel h2 {
            color: var(--accent-primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-default);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification-controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .control-group {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-default);
        }
        
        .control-group h3 {
            color: var(--accent-primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn {
            display: inline-block;
            background: var(--accent-primary);
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            margin: 5px 5px 5px 0;
        }
        
        .btn:hover {
            background: #4493f8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: var(--accent-success);
        }
        
        .btn-success:hover {
            background: #35a64a;
        }
        
        .btn-warning {
            background: var(--accent-warning);
        }
        
        .btn-warning:hover {
            background: #bf8a1d;
        }
        
        .btn-danger {
            background: var(--accent-secondary);
        }
        
        .btn-danger:hover {
            background: #e2443d;
        }
        
        .notification {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent-warning);
            animation: fadeIn 0.5s ease;
        }
        
        .notification.success {
            border-left-color: var(--accent-success);
        }
        
        .notification.warning {
            border-left-color: var(--accent-warning);
        }
        
        .notification.danger {
            border-left-color: var(--accent-secondary);
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .notification-title {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .notification-time {
            color: var(--text-secondary);
            font-size: 0.9em;
        }
        
        .notification-body {
            color: var(--text-primary);
            white-space: pre-line;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-default);
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-value {
            font-weight: 500;
        }
        
        .status-value.granted {
            color: var(--accent-success);
        }
        
        .status-value.denied {
            color: var(--accent-secondary);
        }
        
        .status-value.default {
            color: var(--accent-warning);
        }
        
        .debug-info {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-default);
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
        }
        
        pre {
            white-space: pre-wrap;
            color: var(--text-primary);
            margin: 0;
        }
        
        .class-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .class-card {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-default);
            transition: all 0.3s ease;
        }
        
        .class-card.upcoming {
            border-left: 4px solid var(--accent-warning);
        }
        
        .class-card.active {
            border-left: 4px solid var(--accent-success);
        }
        
        .class-card.completed {
            border-left: 4px solid var(--accent-secondary);
        }
        
        .class-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .class-name {
            font-weight: bold;
            color: var(--accent-primary);
            font-size: 1.1em;
        }
        
        .class-status {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .status-upcoming {
            background: var(--accent-warning);
            color: black;
        }
        
        .status-active {
            background: var(--accent-success);
            color: white;
        }
        
        .status-completed {
            background: var(--accent-secondary);
            color: white;
        }
        
        .class-detail {
            margin-bottom: 8px;
            display: flex;
        }
        
        .detail-label {
            min-width: 80px;
            color: var(--text-secondary);
            font-size: 0.9em;
        }
        
        .detail-value {
            flex: 1;
            font-size: 0.9em;
        }
        
        .class-time {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border-default);
            color: var(--text-secondary);
            font-size: 0.9em;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .key {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }
        
        .key-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .key-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }
        
        .notification-5min { background: var(--accent-warning); }
        .notification-start { background: var(--accent-success); }
        .notification-end { background: var(--accent-secondary); }
        
        .blink {
            animation: blink 2s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-bell"></i> ScheduleOS - Prototype Notifikasi</h1>
            <p class="description">Simulasi notifikasi untuk aplikasi ScheduleOS dengan indikator status kelas</p>
        </header>
        
        <div class="key">
            <div class="key-item">
                <div class="key-color notification-5min"></div>
                <span>Akan Dimulai (Kuning)</span>
            </div>
            <div class="key-item">
                <div class="key-color notification-start"></div>
                <span>Sedang Berlangsung (Hijau)</span>
            </div>
            <div class="key-item">
                <div class="key-color notification-end"></div>
                <span>Telah Selesai (Merah - 24 jam)</span>
            </div>
        </div>
        
        <div class="main-content">
            <div>
                <div class="panel">
                    <h2><i class="fas fa-sliders-h"></i> Kontrol Notifikasi</h2>
                    
                    <div class="notification-controls">
                        <div class="control-group">
                            <h3><i class="fas fa-clock"></i> Notifikasi Jadwal</h3>
                            <button class="btn btn-warning" onclick="showNotification('5min')">
                                <i class="fas fa-bell"></i> 5 Menit Sebelum Kelas
                            </button>
                            <button class="btn btn-success" onclick="showNotification('start')">
                                <i class="fas fa-play-circle"></i> Kelas Dimulai
                            </button>
                            <button class="btn btn-danger" onclick="showNotification('end')">
                                <i class="fas fa-check-circle"></i> Kelas Selesai
                            </button>
                        </div>
                        
                        <div class="control-group">
                            <h3><i class="fas fa-cog"></i> Pengaturan Notifikasi</h3>
                            <button class="btn" onclick="requestNotificationPermission()">
                                <i class="fas fa-question-circle"></i> Request Permission
                            </button>
                            <button class="btn" onclick="testServiceWorkerNotification()">
                                <i class="fas fa-bell"></i> Test Notifikasi (Service Worker)
                            </button>
                        </div>
                        
                        <div class="control-group">
                            <h3><i class="fas fa-list"></i> Contoh Kelas</h3>
                            <button class="btn" onclick="showNotification('pemweb')">
                                <i class="fas fa-code"></i> Pemrograman Web
                            </button>
                            <button class="btn" onclick="showNotification('jarkom')">
                                <i class="fas fa-network-wired"></i> Jaringan Komputer
                            </button>
                            <button class="btn" onclick="showNotification('basdat')">
                                <i class="fas fa-database"></i> Basis Data
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2><i class="fas fa-info-circle"></i> Status Notifikasi</h2>
                    <div class="status-item">
                        <span>Status Permission:</span>
                        <span class="status-value" id="permissionStatus">Mengecek...</span>
                    </div>
                    <div class="status-item">
                        <span>Service Worker:</span>
                        <span class="status-value" id="serviceWorkerStatus">Mengecek...</span>
                    </div>
                    <div class="status-item">
                        <span>Browser Support:</span>
                        <span class="status-value" id="browserSupportStatus">Mengecek...</span>
                    </div>
                </div>
                
                <div class="panel">
                    <h2><i class="fas fa-bug"></i> Informasi Debug</h2>
                    <div class="debug-info">
                        <pre id="debugInfo">Menunggu informasi...</pre>
                    </div>
                </div>
            </div>
            
            <div>
                <div class="panel">
                    <h2><i class="fas fa-history"></i> Notifikasi Terakhir</h2>
                    <div id="notificationContainer">
                        <div class="notification">
                            <div class="notification-header">
                                <div class="notification-title">Selamat datang di ScheduleOS Notifications</div>
                                <div class="notification-time" id="currentTime"></div>
                            </div>
                            <div class="notification-body">
                                Notifikasi akan muncul di sini ketika Anda melakukan test.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2><i class="fas fa-graduation-cap"></i> Daftar Mata Kuliah</h2>
                    <div class="class-list" id="classList">
                        <!-- Class cards will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Daftar mata kuliah contoh
        const classes = [
            {
                id: 1,
                name: "Pemrograman Web",
                instructor: "Dr. Ahmad",
                room: "Lab. Komputer A",
                day: "Senin",
                startTime: "10:00",
                endTime: "12:00",
                status: "upcoming" // upcoming, active, completed
            },
            {
                id: 2,
                name: "Jaringan Komputer",
                instructor: "Dr. Budi",
                room: "Lab. Jaringan B",
                day: "Selasa",
                startTime: "13:00",
                endTime: "15:00",
                status: "upcoming"
            },
            {
                id: 3,
                name: "Basis Data",
                instructor: "Dr. Citra",
                room: "Lab. Database C",
                day: "Rabu",
                startTime: "09:00",
                endTime: "11:00",
                status: "completed"
            },
            {
                id: 4,
                name: "Sistem Operasi",
                instructor: "Dr. Dian",
                room: "Lab. Komputer D",
                day: "Kamis",
                startTime: "14:00",
                endTime: "16:00",
                status: "active"
            }
        ];

        // Update current time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID');
            document.getElementById('currentTime').textContent = timeString;
        }
        
        setInterval(updateTime, 1000);
        updateTime();
        
        // Check notification permission
        function checkNotificationPermission() {
            if (!("Notification" in window)) {
                document.getElementById('permissionStatus').textContent = "Tidak didukung";
                document.getElementById('permissionStatus').className = "status-value denied";
                return false;
            }
            
            const permission = Notification.permission;
            const statusElement = document.getElementById('permissionStatus');
            
            statusElement.textContent = permission;
            
            if (permission === "granted") {
                statusElement.className = "status-value granted";
            } else if (permission === "denied") {
                statusElement.className = "status-value denied";
            } else {
                statusElement.className = "status-value default";
            }
            
            return permission === "granted";
        }
        
        // Check service worker support
        function checkServiceWorker() {
            const statusElement = document.getElementById('serviceWorkerStatus');
            
            if ('serviceWorker' in navigator) {
                statusElement.textContent = "Didukung";
                statusElement.className = "status-value granted";
                return true;
            } else {
                statusElement.textContent = "Tidak didukung";
                statusElement.className = "status-value denied";
                return false;
            }
        }
        
        // Check browser support
        function checkBrowserSupport() {
            const statusElement = document.getElementById('browserSupportStatus');
            let support = [];
            
            if ("Notification" in window) support.push("Notification API");
            if ('serviceWorker' in navigator) support.push("Service Worker");
            if ('PushManager' in window) support.push("Push Manager");
            
            if (support.length > 0) {
                statusElement.textContent = support.join(", ");
                statusElement.className = "status-value granted";
            } else {
                statusElement.textContent = "Minimal support tidak ditemukan";
                statusElement.className = "status-value denied";
            }
        }
        
        // Request notification permission
        function requestNotificationPermission() {
            if (!("Notification" in window)) {
                addDebugInfo("Browser tidak mendukung Notifications API");
                return;
            }
            
            Notification.requestPermission().then(function(permission) {
                addDebugInfo("Permission status: " + permission);
                checkNotificationPermission();
                
                if (permission === "granted") {
                    showNotification("permission_granted");
                }
            });
        }
        
        // Test service worker notification
        function testServiceWorkerNotification() {
            if (!checkNotificationPermission()) {
                addDebugInfo("Tidak memiliki izin notifikasi");
                return;
            }
            
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                // Mengirim message ke service worker untuk menampilkan notifikasi
                navigator.serviceWorker.controller.postMessage({
                    type: 'SHOW_NOTIFICATION',
                    title: 'Test Notifikasi Service Worker',
                    options: {
                        body: 'Ini adalah test notifikasi dari Service Worker.',
                        icon: 'https://example.com/icon.png',
                        badge: 'https://example.com/badge.png'
                    }
                });
                
                addDebugInfo("Mengirim permintaan notifikasi ke Service Worker");
                addNotification("Service Worker Test", "Permintaan notifikasi dikirim ke Service Worker", "success");
            } else {
                addDebugInfo("Service Worker tidak tersedia, menggunakan fallback");
                
                // Fallback untuk browser yang tidak mendukung service worker
                try {
                    const notification = new Notification("Test Notifikasi", {
                        body: "Ini adalah test notifikasi fallback.",
                        icon: "https://example.com/icon.png"
                    });
                    
                    notification.onclick = function() {
                        window.focus();
                        notification.close();
                    };
                    
                    addDebugInfo("Notifikasi fallback berhasil dikirim");
                    addNotification("Fallback Test", "Notifikasi fallback berhasil dikirim", "success");
                } catch (error) {
                    addDebugInfo("Error mengirim notifikasi fallback: " + error.message);
                }
            }
        }
        
        // Show notification based on type
        function showNotification(type) {
            let title, body, notifClass;
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID');
            
            switch(type) {
                case '5min':
                    title = "⚡ Class Starting in 5 Minutes";
                    body = "Pemrograman Web will start at 10:00\nLocation: Lab. Komputer\nInstructor: Dr. Ahmad";
                    notifClass = "warning";
                    break;
                case 'start':
                    title = "🚀 Class is Starting Now!";
                    body = "Pemrograman Web is now running\nLocation: Lab. Komputer\nInstructor: Dr. Ahmad";
                    notifClass = "success";
                    break;
                case 'end':
                    title = "✅ Class Completed";
                    body = "Pemrograman Web has ended\nGreat job!";
                    notifClass = "danger";
                    break;
                case 'pemweb':
                    title = "⏰ Pemrograman Web";
                    body = "Kelas akan dimulai dalam 5 menit\nRuangan: Lab. Komputer A";
                    notifClass = "warning";
                    // Update status kelas
                    updateClassStatus(1, "upcoming");
                    break;
                case 'jarkom':
                    title = "⏰ Jaringan Komputer";
                    body = "Kelas akan dimulai dalam 5 menit\nRuangan: Lab. Jaringan B";
                    notifClass = "warning";
                    // Update status kelas
                    updateClassStatus(2, "upcoming");
                    break;
                case 'basdat':
                    title = "⏰ Basis Data";
                    body = "Kelas akan dimulai dalam 5 menit\nRuangan: Lab. Database C";
                    notifClass = "warning";
                    // Update status kelas
                    updateClassStatus(3, "upcoming");
                    break;
                case 'permission_granted':
                    title = "Permission Diberikan";
                    body = "Aplikasi sekarang dapat mengirimkan notifikasi";
                    notifClass = "success";
                    break;
                default:
                    title = "Test Notification";
                    body = "This is a test notification";
                    notifClass = "";
            }
            
            // Add to notification display
            addNotification(title, body, notifClass);
            
            // Also try to show browser notification if permission is granted
            if (checkNotificationPermission()) {
                try {
                    // Menggunakan service worker jika tersedia
                    if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                        navigator.serviceWorker.controller.postMessage({
                            type: 'SHOW_NOTIFICATION',
                            title: title,
                            options: {
                                body: body,
                                icon: 'https://example.com/icon.png',
                                badge: 'https://example.com/badge.png'
                            }
                        });
                    } else {
                        // Fallback ke Notification API
                        const notification = new Notification(title, { body: body });
                        notification.onclick = function() {
                            window.focus();
                            notification.close();
                        };
                    }
                    
                    addDebugInfo("Notifikasi dikirim: " + type);
                } catch (error) {
                    addDebugInfo("Error mengirim notifikasi: " + error.message);
                }
            }
        }
        
        // Add notification to display
        function addNotification(title, body, notifClass = "") {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID');
            
            const notificationElement = document.createElement('div');
            notificationElement.className = `notification ${notifClass}`;
            notificationElement.innerHTML = `
                <div class="notification-header">
                    <div class="notification-title">${title}</div>
                    <div class="notification-time">${timeString}</div>
                </div>
                <div class="notification-body">${body.replace(/\n/g, '<br>')}</div>
            `;
            
            const container = document.getElementById('notificationContainer');
            container.insertBefore(notificationElement, container.firstChild);
            
            // Limit to 5 notifications
            if (container.children.length > 5) {
                container.removeChild(container.lastChild);
            }
        }
        
        // Add debug info
        function addDebugInfo(message) {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID');
            const debugElement = document.getElementById('debugInfo');
            
            debugElement.textContent = `[${timeString}] ${message}\n${debugElement.textContent}`;
            
            // Limit to 10 lines
            const lines = debugElement.textContent.split('\n');
            if (lines.length > 10) {
                debugElement.textContent = lines.slice(0, 10).join('\n');
            }
        }
        
        // Render class list
        function renderClassList() {
            const classList = document.getElementById('classList');
            classList.innerHTML = '';
            
            classes.forEach(classItem => {
                const classCard = document.createElement('div');
                classCard.className = `class-card ${classItem.status}`;
                
                let statusText = '';
                let statusClass = '';
                
                switch(classItem.status) {
                    case 'upcoming':
                        statusText = 'Akan Dimulai';
                        statusClass = 'status-upcoming';
                        break;
                    case 'active':
                        statusText = 'Berlangsung';
                        statusClass = 'status-active';
                        break;
                    case 'completed':
                        statusText = 'Selesai';
                        statusClass = 'status-completed';
                        break;
                }
                
                classCard.innerHTML = `
                    <div class="class-header">
                        <div class="class-name">${classItem.name}</div>
                        <div class="class-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="class-detail">
                        <span class="detail-label">Dosen:</span>
                        <span class="detail-value">${classItem.instructor}</span>
                    </div>
                    <div class="class-detail">
                        <span class="detail-label">Ruangan:</span>
                        <span class="detail-value">${classItem.room}</span>
                    </div>
                    <div class="class-detail">
                        <span class="detail-label">Hari:</span>
                        <span class="detail-value">${classItem.day}</span>
                    </div>
                    <div class="class-time">
                        <span>${classItem.startTime} - ${classItem.endTime}</span>
                        <button class="btn" onclick="testClassNotification(${classItem.id})">
                            <i class="fas fa-bell"></i> Test
                        </button>
                    </div>
                `;
                
                classList.appendChild(classCard);
            });
        }
        
        // Update class status
        function updateClassStatus(classId, status) {
            const classItem = classes.find(c => c.id === classId);
            if (classItem) {
                classItem.status = status;
                renderClassList();
                
                // Jika status completed, atur timer untuk mengembalikan ke normal setelah 24 jam
                if (status === 'completed') {
                    setTimeout(() => {
                        classItem.status = 'upcoming';
                        renderClassList();
                    }, 5000); // 5 detik untuk demo (biasanya 24 jam)
                }
            }
        }
        
        // Test notification for specific class
        function testClassNotification(classId) {
            const classItem = classes.find(c => c.id === classId);
            if (classItem) {
                const title = `⏰ ${classItem.name}`;
                const body = `Kelas akan dimulai dalam 5 menit\nRuangan: ${classItem.room}\nDosen: ${classItem.instructor}`;
                
                addNotification(title, body, "warning");
                updateClassStatus(classId, "upcoming");
                
                addDebugInfo(`Test notifikasi untuk kelas: ${classItem.name}`);
            }
        }
        
        // Initialize
        function init() {
            checkNotificationPermission();
            checkServiceWorker();
            checkBrowserSupport();
            renderClassList();
            
            addDebugInfo("Prototype notifikasi diinisialisasi");
            
            // Test notification after a delay
            setTimeout(() => {
                showNotification('5min');
            }, 2000);
        }
        
        // Run initialization when page loads
        window.onload = init;
    </script>
</body>
</html>